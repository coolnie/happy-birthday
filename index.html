<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>æ˜±å®å€‹äººè³‡è¨Šæ›´æ–°ç³»çµ±</title>
    <style>
        :root {
            --forest-green: #2D5A27;
            --leaf-green: #A8C69F;
            --earth-brown: #5D4037;
            --soft-beige: #F5F5DC;
            --heart-red: #ff4d6d;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: "Microsoft JhengHei", sans-serif;
            background: linear-gradient(180deg, var(--forest-green), var(--leaf-green));
            color: var(--soft-beige);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            <div style="width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-bottom: 20px;">
    <div id="progress" style="width: 0%; height: 100%; background: #fff; border-radius: 2px; transition: 0.5s;"></div>
</div>
            width: 90%;
            max-width: 400px;
            text-align: center;
            padding: 30px 20px;
            margin-top: 50px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            height: fit-content;
        }

        .decor { font-size: 2rem; margin-bottom: 10px; }

        .btn-group { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        button {
            padding: 12px 25px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        .btn-yes { background-color: #f8ad9d; color: white; }
        .btn-no { background-color: #6c757d; color: white; }
        .btn-next { background-color: var(--earth-brown); color: white; width: 100%; }

        input, textarea {
            width: 90%;
            padding: 10px;
            border-radius: 10px;
            border: none;
            margin-top: 15px;
            font-family: inherit;
        }

        .scratch-card {
            position: relative;
            width: 260px;
            height: 130px;
            margin: 20px auto;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        canvas { position: absolute; top: 0; left: 0; touch-action: none; }
        .coupon-text { color: var(--earth-brown); font-weight: bold; padding: 10px; }

        .heart {
            position: fixed;
            color: var(--heart-red);
            font-size: 20px;
            user-select: none;
            pointer-events: none;
            animation: moveUp 1.5s linear forwards;
            z-index: 999;
        }
        @keyframes moveUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-200px) scale(1.5); opacity: 0; }
        }
    </style>
</head>
<body>

<div class="container">
    <div id="game-area">
        <div class="decor">ğŸ¥‚âœ¨ğŸ‚</div>
        //è£é€²åº¦æ¢
        <div style="width: 100%; height: 10px; background: rgba(255,255,255,0.2); border-radius: 5px; margin: 20px 0; position: relative;">
        <div id="progress" style="width: 0%; height: 100%; background: #fff; border-radius: 5px; transition: 0.5s ease; position: relative;">
            <span id="gift-icon" style="position: absolute; right: -10px; top: -10px; font-size: 20px; transition: 0.5s ease; display: none;">ğŸ</span>
        </div>
    </div>

    <div id="content">
        </div>
</div>
        <div id="content">
            <h2 id="title">æ­å–œæ˜±å®é•·å¤§ä¸€æ­²ï¼</h2>
            <p id="desc">è«‹é–‹å§‹æ›´æ–°æ‚¨çš„å€‹äººè³‡è¨Š</p>
            <button class="btn-next" onclick="startQuiz()">é–‹å§‹å¡«å¯«</button>
        </div>
    </div>
</div>

<script>
    // æ³¨æ„ï¼šè«‹åœ¨æ­¤è™•å¡«å…¥å¦³åœ¨ Formspree ç”³è«‹åˆ°çš„ç¶²å€
    const FORMSPREE_URL = "https://formspree.io/f/mnjqeopy"; 

    const questions = [
        { type: "yn", q: "1. ä¸å–œæ­¡æµ·é®®ï¼ŒåŒ…æ‹¬é¾è¦è·Ÿç”Ÿé­šç‰‡å£½å¸ï¼Œå¯æ˜¯å–œæ­¡è¦å­ã€è›¤èœŠã€å³éƒ­é­šã€çƒ¤é­·é­š" },
        { type: "yn", q: "2. å–œæ­¡å°éš»çš„è¦å­å‹éå¤§éš»çš„" },
        { type: "yn", q: "3. ä¸å–œæ­¡åœ°ç“œè‘‰" },
        { type: "yn", q: "4. ä¸å–œæ­¡å¾ˆå¤šèŠ‹æ³¥çš„èŠ‹é ­ç‰›å¥¶" },
        { type: "yn", q: "5. è¦ºå¾—æ¾éœ²å¾ˆè‡­" },
        { type: "yn", q: "6. ä¸å–œæ­¡ Mister Donuts" },
        { type: "yn", q: "7. å–œæ­¡é³³æ¢¨&å“ˆå¯†ç“œï¼Œä½†æ˜¯ä¸å–œæ­¡é³³æ¢¨/å“ˆå¯†ç“œå£å‘³çš„æ±è¥¿" },
        { type: "only-yes", q: "8. æˆ‘é•·å¤§äº†ï¼Œæ²’æœ‰ç”šéº¼é›£å¾—å€’æˆ‘ï¼" },
        { type: "input", q: "æœ€å¾Œ. ç”Ÿæ—¥é¡˜æœ›(å¥³æœ‹å‹ä½¿å‘½å¿…é”)" }
    ];

    let currentIdx = 0;
    let birthdayWish = "";
    let corrections = {}; // ç”¨ä¾†å­˜æ”¾ä»–é¸ã€Œå¦ã€ä¹‹å¾Œè¼¸å…¥çš„æ­£ç¢ºè³‡è¨Š

    function startQuiz() { showQuestion(); }

    function showQuestion() {
       // 1. è¨ˆç®—ç™¾åˆ†æ¯”
    const progress = ((currentIdx) / questions.length) * 100;
    
    // 2. æ›´æ–°é€²åº¦æ¢å¯¬åº¦
    const progressEl = document.getElementById('progress');
    const giftEl = document.getElementById('gift-icon');
    
    if (progressEl) {
        progressEl.style.width = progress + '%';
    }
    
    // 3. è®“ç¦®ç‰©åœ–æ¡ˆå‡ºç¾
    if (giftEl) {
        giftEl.style.display = 'block';
    }
        //åŸæœ¬çš„é¡Œç›®é–‹å§‹
        const q = questions[currentIdx];
        let html = `<h3>é¡Œç›® ${currentIdx + 1} / 9</h3><p>${q.q}</p>`;

        if (q.type === "yn") {
            html += `<div class="btn-group">
                        <button class="btn-yes" onclick="handleYes()">æ˜¯</button>
                        <button class="btn-no" onclick="handleNo()">å¦</button>
                    </div>`;
        } else if (q.type === "input") {
            html += `<textarea id="wish-input" rows="3" placeholder="å¯«ä¸‹ä½ çš„é¡˜æœ›..."></textarea>
                    <button class="btn-next" onclick="saveWishAndNext()">ä¸‹ä¸€æ­¥</button>`;
        } else if (q.type === "only-yes") {
            html += `<div class="btn-group">
                        <button class="btn-yes" style="width:100%" onclick="submitAndFinish()">æ˜¯</button>
                    </div>`;
        }
        document.getElementById('content').innerHTML = html;
    }

    function handleYes() { createHearts(); setTimeout(nextQuestion, 600); }

    function handleNo() {
        const questionKey = `ç¬¬${currentIdx + 1}é¡Œå›è¦†`;
        document.getElementById('content').innerHTML = `
            <p style="color: #ffeb3b; font-weight: bold;">å”‰å”·å–‚ï¼Œé‡‘æ‹è¬! <br>è«‹æ›´æ–°æ­£ç¢ºè³‡è¨Šï¼Œè®“æˆ‘æä¾›æ‚¨æ›´å¥½çš„äººç”Ÿé«”é©—</p>
            <input type="text" id="correction-input" placeholder="è¼¸å…¥æ­£ç¢ºè³‡è¨Š">
            <button class="btn-next" onclick="saveCorrectionAndNext('${questionKey}')">æ›´æ–°å®Œæˆ!!</button>
        `;
    }

    function saveCorrectionAndNext(key) {
        const inputEl = document.getElementById('correction-input');
        const val = inputEl.value;
        
        // å¼·åˆ¶è¼¸å…¥æ¡†å¤±å»ç„¦é»ï¼Œæ”¶èµ·éµç›¤
        inputEl.blur(); 
        
        corrections[key] = val || "ï¼ˆé»é¸å¦ä½†æœªè¼¸å…¥æ–‡å­—ï¼‰";
        
        // ç¨å¾®å»¶é²ä¸€ä¸‹å†è·³é¡Œï¼Œè®“ç•«é¢æœ‰æ™‚é–“æ­¸ä½
        setTimeout(nextQuestion, 100);
    }

    function saveWishAndNext() {
        birthdayWish = document.getElementById('wish-input').value;
        nextQuestion();
    }

    function nextQuestion() {
        currentIdx++;
        if (currentIdx < questions.length) { showQuestion(); }
    }

    function submitAndFinish() {
        createHearts();
        document.getElementById('content').innerHTML = `<p>æ­£åœ¨åŒæ­¥è³‡è¨Šåˆ°å¶çš„å¿ƒä¸­...</p>`;
        
        // æ•´ç†æ‰€æœ‰è¦ç™¼é€çš„è³‡æ–™
        const payload = {
            "ç”Ÿæ—¥é¡˜æœ›": birthdayWish,
            "ä¿®æ­£è³‡è¨Š": corrections,
            "é•·å¤§å®£è¨€": "æ˜¯"
        };
        
        fetch(FORMSPREE_URL, {
            method: 'POST',
            body: JSON.stringify(payload),
            headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' }
        }).finally(() => {
            showFinal();
        });
    }

    function showFinal() {
        document.getElementById('content').innerHTML = `
            <h2>æ„Ÿè¬ä½ çš„é…åˆï¼</h2>
            <p>å·²æ¥æ”¶åˆ°æœ€æ–°è³‡è¨Š >3<</p>
            <button class="btn-next" onclick="showScratch()">æŸ¥çœ‹çå‹µ</button>
        `;
    }

    function showScratch() {
        document.getElementById('game-area').innerHTML = `
            <div id="scratch-area" style="display:block">
                <h1>âœ¨ ç”Ÿæ—¥å…Œæ›åˆ¸ âœ¨</h1>
                
                <div class="scratch-card">
                    <div class="coupon-text" style="color: #6a8d6d;">é•·å¤§çš„å‘³é“</div>
                    <canvas id="s1" width="260" height="130"></canvas>
                </div>

                <div class="scratch-card">
                    <div class="coupon-text" style="color: #B8860B;">ğŸ« æ±°èˆŠæ›æ–°åˆ¸</div>
                    <canvas id="s2" width="260" height="130"></canvas>
                </div>

                <p style="font-size: 0.8rem; opacity: 0.8; margin-top: 20px;">ğŸ’¡ æˆªåœ–ä¿å­˜ï¼Œä»¥å…è¨€æ°´é¦¨å¿˜è¨˜</p>
                <p>Happy Birthday <3</p>
            </div>
        `;
        initScratch('s1');
        initScratch('s2');
    }

    function createHearts() {
        for(let i=0; i<10; i++) {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.innerText = 'â¤';
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.top = '80vh';
            heart.style.fontSize = (Math.random() * 20 + 20) + 'px';
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1500);
        }
    }

    function initScratch(id) {
        const canvas = document.getElementById(id);
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#C0C0C0';
        ctx.fillRect(0, 0, 260, 130);
        let isDrawing = false;
        const scratch = (e) => {
            if(!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
            const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(x, y, 20, 0, Math.PI*2);
            ctx.fill();
        };
        canvas.addEventListener('mousedown', () => isDrawing = true);
        canvas.addEventListener('touchstart', () => isDrawing = true);
        window.addEventListener('mouseup', () => isDrawing = false);
        window.addEventListener('touchend', () => isDrawing = false);
        canvas.addEventListener('mousemove', scratch);
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); scratch(e); });
    }
</script>
</body>

</html>



